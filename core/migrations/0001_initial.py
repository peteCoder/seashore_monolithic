# Generated by Django 5.2.6 on 2026-02-03 13:15

import cloudinary.models
import datetime
import django.core.validators
import django.db.models.deletion
import django.db.models.expressions
import django.utils.timezone
import uuid
from decimal import Decimal
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('auth', '0012_alter_user_first_name_max_length'),
    ]

    operations = [
        migrations.CreateModel(
            name='AccountType',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('name', models.CharField(choices=[('asset', 'Asset'), ('liability', 'Liability'), ('equity', 'Equity'), ('income', 'Income'), ('expense', 'Expense')], help_text='Account type classification', max_length=50, unique=True)),
                ('normal_balance', models.CharField(choices=[('debit', 'Debit'), ('credit', 'Credit')], help_text='Normal balance side (debit or credit)', max_length=10)),
                ('description', models.TextField(blank=True)),
            ],
            options={
                'verbose_name': 'Account Type',
                'verbose_name_plural': 'Account Types',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='User',
            fields=[
                ('password', models.CharField(max_length=128, verbose_name='password')),
                ('is_superuser', models.BooleanField(default=False, help_text='Designates that this user has all permissions without explicitly assigning them.', verbose_name='superuser status')),
                ('first_name', models.CharField(blank=True, max_length=150, verbose_name='first name')),
                ('last_name', models.CharField(blank=True, max_length=150, verbose_name='last name')),
                ('is_staff', models.BooleanField(default=False, help_text='Designates whether the user can log into this admin site.', verbose_name='staff status')),
                ('is_active', models.BooleanField(default=True, help_text='Designates whether this user should be treated as active. Unselect this instead of deleting accounts.', verbose_name='active')),
                ('date_joined', models.DateTimeField(default=django.utils.timezone.now, verbose_name='date joined')),
                ('deactivated_at', models.DateTimeField(blank=True, help_text='When this record was deactivated', null=True)),
                ('deactivation_reason', models.TextField(blank=True, help_text='Reason for deactivation')),
                ('email', models.EmailField(db_index=True, max_length=254, unique=True)),
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('user_role', models.CharField(choices=[('staff', 'Staff/Loan Officer'), ('manager', 'Branch Manager'), ('director', 'Director'), ('admin', 'System Administrator')], db_index=True, max_length=20)),
                ('phone', models.CharField(blank=True, max_length=17, validators=[django.core.validators.RegexValidator(regex='^\\+?1?\\d{9,15}$')])),
                ('employee_id', models.CharField(blank=True, db_index=True, help_text='Auto-generated employee ID (EMP001, EMP002, etc.)', max_length=20, null=True, unique=True)),
                ('designation', models.CharField(blank=True, help_text='Job title/position', max_length=100)),
                ('department', models.CharField(blank=True, choices=[('operations', 'Operations'), ('loans', 'Loans'), ('savings', 'Savings'), ('customer_service', 'Customer Service'), ('accounts', 'Accounts/Finance'), ('IT', 'IT/Technical'), ('management', 'Management'), ('board', 'Board of Directors')], max_length=50)),
                ('password_reset_token', models.CharField(blank=True, help_text='Token for password reset', max_length=100, null=True)),
                ('password_reset_expires', models.DateTimeField(blank=True, help_text='Expiry time for reset token', null=True)),
                ('hire_date', models.DateField(blank=True, null=True)),
                ('termination_date', models.DateField(blank=True, null=True)),
                ('salary', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('bank_account', models.CharField(blank=True, max_length=20)),
                ('bank_name', models.CharField(blank=True, max_length=100)),
                ('date_of_birth', models.DateField(blank=True, null=True)),
                ('gender', models.CharField(blank=True, choices=[('male', 'Male'), ('female', 'Female'), ('other', 'Other')], max_length=10)),
                ('blood_group', models.CharField(blank=True, choices=[('A+', 'A+'), ('A-', 'A-'), ('B+', 'B+'), ('B-', 'B-'), ('AB+', 'AB+'), ('AB-', 'AB-'), ('O+', 'O+'), ('O-', 'O-')], max_length=5)),
                ('address', models.TextField(blank=True)),
                ('emergency_contact_name', models.CharField(blank=True, max_length=100)),
                ('emergency_contact_phone', models.CharField(blank=True, max_length=17)),
                ('emergency_contact_relationship', models.CharField(blank=True, max_length=50)),
                ('can_approve_loans', models.BooleanField(default=False)),
                ('can_approve_accounts', models.BooleanField(default=False)),
                ('max_approval_amount', models.DecimalField(blank=True, decimal_places=2, help_text='Maximum amount this staff can approve', max_digits=12, null=True, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('id_type', models.CharField(blank=True, choices=[('national_id', 'National ID'), ('passport', 'International Passport'), ('drivers_license', "Driver's License"), ('voters_card', "Voter's Card")], max_length=50)),
                ('id_number', models.CharField(blank=True, max_length=50)),
                ('profile_picture', cloudinary.models.CloudinaryField(blank=True, max_length=255, null=True, verbose_name='profile_picture')),
                ('id_card_front', cloudinary.models.CloudinaryField(blank=True, max_length=255, null=True, verbose_name='id_card_front')),
                ('id_card_back', cloudinary.models.CloudinaryField(blank=True, max_length=255, null=True, verbose_name='id_card_back')),
                ('cv_document', cloudinary.models.CloudinaryField(blank=True, max_length=255, null=True, verbose_name='cv_document')),
                ('notes', models.TextField(blank=True)),
                ('is_approved', models.BooleanField(db_index=True, default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('last_login', models.DateTimeField(blank=True, null=True)),
                ('failed_login_attempts', models.IntegerField(default=0)),
                ('account_locked_until', models.DateTimeField(blank=True, null=True)),
                ('deactivated_by', models.ForeignKey(blank=True, help_text='User who deactivated this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deactivated', to=settings.AUTH_USER_MODEL)),
                ('groups', models.ManyToManyField(blank=True, related_name='custom_user_set', to='auth.group')),
                ('reports_to', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='direct_reports', to=settings.AUTH_USER_MODEL)),
                ('user_permissions', models.ManyToManyField(blank=True, related_name='custom_user_set', to='auth.permission')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='AccountCategory',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('name', models.CharField(help_text='Category name', max_length=100)),
                ('code_prefix', models.CharField(help_text="Code prefix (e.g., '1' for Assets, '182' for Loan Receivables)", max_length=3, unique=True)),
                ('description', models.TextField(blank=True)),
                ('account_type', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='categories', to='core.accounttype')),
            ],
            options={
                'verbose_name': 'Account Category',
                'verbose_name_plural': 'Account Categories',
                'ordering': ['code_prefix'],
            },
        ),
        migrations.CreateModel(
            name='Branch',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('is_active', models.BooleanField(db_index=True, default=True, help_text='Is this record active?')),
                ('deactivated_at', models.DateTimeField(blank=True, help_text='When this record was deactivated', null=True)),
                ('deactivation_reason', models.TextField(blank=True, help_text='Reason for deactivation')),
                ('name', models.CharField(help_text='Branch name', max_length=100)),
                ('code', models.CharField(db_index=True, help_text="Unique branch code (e.g., 'MB01', 'IKJ')", max_length=20, unique=True)),
                ('address', models.TextField()),
                ('city', models.CharField(blank=True, max_length=100, null=True)),
                ('state', models.CharField(max_length=100)),
                ('phone', models.CharField(max_length=20)),
                ('email', models.EmailField(max_length=254)),
                ('deactivated_by', models.ForeignKey(blank=True, help_text='User who deactivated this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deactivated', to=settings.AUTH_USER_MODEL)),
                ('manager', models.ForeignKey(blank=True, help_text='Branch manager', limit_choices_to={'user_role': 'manager'}, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='managed_branches', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name_plural': 'Branches',
                'ordering': ['name'],
            },
        ),
        migrations.AddField(
            model_name='user',
            name='branch',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='users', to='core.branch'),
        ),
        migrations.CreateModel(
            name='ChartOfAccounts',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('gl_code', models.CharField(db_index=True, help_text="GL Code (e.g., '14', '182', '400')", max_length=10, unique=True)),
                ('account_name', models.CharField(help_text='Account name', max_length=200)),
                ('currency', models.CharField(default='NGN', max_length=3)),
                ('is_control_account', models.BooleanField(default=False, help_text='Is this a control/summary account?')),
                ('is_active', models.BooleanField(default=True)),
                ('allows_manual_entries', models.BooleanField(default=True, help_text='Can manual journal entries be posted?')),
                ('description', models.TextField(blank=True)),
                ('account_category', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='accounts', to='core.accountcategory')),
                ('account_type', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='accounts', to='core.accounttype')),
                ('branch', models.ForeignKey(blank=True, help_text='Leave blank for system-wide accounts', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='gl_accounts', to='core.branch')),
                ('parent_account', models.ForeignKey(blank=True, help_text='Parent account for hierarchical structure', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='sub_accounts', to='core.chartofaccounts')),
            ],
            options={
                'verbose_name': 'Chart of Account',
                'verbose_name_plural': 'Chart of Accounts',
                'ordering': ['gl_code'],
            },
        ),
        migrations.CreateModel(
            name='ClientGroup',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('approval_status', models.CharField(choices=[('draft', 'Draft'), ('pending', 'Pending Approval'), ('approved', 'Approved'), ('rejected', 'Rejected')], db_index=True, default='draft', max_length=20)),
                ('approved_at', models.DateTimeField(blank=True, help_text='When this record was approved', null=True)),
                ('rejection_reason', models.TextField(blank=True, help_text='Reason for rejection')),
                ('is_active', models.BooleanField(db_index=True, default=True, help_text='Is this record active?')),
                ('deactivated_at', models.DateTimeField(blank=True, help_text='When this record was deactivated', null=True)),
                ('deactivation_reason', models.TextField(blank=True, help_text='Reason for deactivation')),
                ('name', models.CharField(max_length=100, unique=True)),
                ('code', models.CharField(blank=True, db_index=True, max_length=20, unique=True)),
                ('description', models.TextField(blank=True)),
                ('group_type', models.CharField(choices=[('lending', 'Lending Group'), ('savings', 'Savings Group'), ('mixed', 'Mixed (Lending & Savings)'), ('cooperative', 'Cooperative'), ('self_help', 'Self-Help Group')], default='mixed', help_text='Type of group activity', max_length=20)),
                ('registration_date', models.DateField(default=datetime.date.today)),
                ('meeting_day', models.CharField(blank=True, choices=[('monday', 'Monday'), ('tuesday', 'Tuesday'), ('wednesday', 'Wednesday'), ('thursday', 'Thursday'), ('friday', 'Friday'), ('saturday', 'Saturday'), ('sunday', 'Sunday')], help_text='Day of the week for group meetings', max_length=10)),
                ('meeting_frequency', models.CharField(choices=[('daily', 'Daily'), ('weekly', 'Weekly'), ('fortnightly', 'Fortnightly'), ('monthly', 'Monthly')], default='weekly', max_length=20)),
                ('meeting_time', models.TimeField(blank=True, help_text='Time of group meetings', null=True)),
                ('meeting_location', models.CharField(blank=True, help_text='Physical location where group meets', max_length=200)),
                ('max_members', models.PositiveIntegerField(blank=True, help_text='Maximum number of members allowed (leave empty for unlimited)', null=True)),
                ('status', models.CharField(choices=[('pending', 'Pending Approval'), ('active', 'Active'), ('inactive', 'Inactive'), ('closed', 'Closed')], db_index=True, default='pending', max_length=20)),
                ('total_members', models.IntegerField(default=0)),
                ('active_members', models.IntegerField(default=0)),
                ('total_savings', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_loans_outstanding', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('approved_by', models.ForeignKey(blank=True, help_text='User who approved this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_approved', to=settings.AUTH_USER_MODEL)),
                ('branch', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='client_groups', to='core.branch')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_client_groups', to=settings.AUTH_USER_MODEL)),
                ('deactivated_by', models.ForeignKey(blank=True, help_text='User who deactivated this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deactivated', to=settings.AUTH_USER_MODEL)),
                ('loan_officer', models.ForeignKey(blank=True, limit_choices_to={'user_role__in': ['loan_officer', 'manager']}, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='managed_client_groups', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Client Group',
                'verbose_name_plural': 'Client Groups',
                'ordering': ['name'],
            },
        ),
        migrations.CreateModel(
            name='Client',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('approval_status', models.CharField(choices=[('draft', 'Draft'), ('pending', 'Pending Approval'), ('approved', 'Approved'), ('rejected', 'Rejected')], db_index=True, default='draft', max_length=20)),
                ('approved_at', models.DateTimeField(blank=True, help_text='When this record was approved', null=True)),
                ('rejection_reason', models.TextField(blank=True, help_text='Reason for rejection')),
                ('is_active', models.BooleanField(db_index=True, default=True, help_text='Is this record active?')),
                ('deactivated_at', models.DateTimeField(blank=True, help_text='When this record was deactivated', null=True)),
                ('deactivation_reason', models.TextField(blank=True, help_text='Reason for deactivation')),
                ('client_id', models.CharField(blank=True, db_index=True, help_text='Auto-generated client ID', max_length=20, unique=True)),
                ('external_id', models.CharField(blank=True, db_index=True, help_text='External / legacy system identifier', max_length=100)),
                ('first_name', models.CharField(max_length=150)),
                ('last_name', models.CharField(max_length=150)),
                ('nickname', models.CharField(blank=True, help_text="Client's common name or nickname", max_length=100)),
                ('email', models.EmailField(db_index=True, max_length=254, unique=True)),
                ('phone', models.CharField(max_length=17, validators=[django.core.validators.RegexValidator(regex='^\\+?1?\\d{9,15}$')])),
                ('alternate_phone', models.CharField(blank=True, max_length=17, validators=[django.core.validators.RegexValidator(regex='^\\+?1?\\d{9,15}$')])),
                ('date_of_birth', models.DateField()),
                ('gender', models.CharField(choices=[('male', 'Male'), ('female', 'Female'), ('other', 'Other')], max_length=10)),
                ('marital_status', models.CharField(blank=True, choices=[('single', 'Single'), ('married', 'Married'), ('divorced', 'Divorced'), ('widowed', 'Widowed')], max_length=20)),
                ('number_of_dependents', models.IntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(0)])),
                ('education_level', models.CharField(blank=True, choices=[('none', 'No Formal Education'), ('primary', 'Primary Education'), ('secondary', 'Secondary Education'), ('tertiary', 'Tertiary Education'), ('postgraduate', 'Postgraduate')], max_length=50)),
                ('residential_status', models.CharField(blank=True, choices=[('owned', 'Owned'), ('rented', 'Rented'), ('family', 'Family Owned'), ('other', 'Other')], max_length=20)),
                ('address', models.TextField()),
                ('city', models.CharField(max_length=100)),
                ('state', models.CharField(max_length=100)),
                ('postal_code', models.CharField(blank=True, max_length=20)),
                ('country', models.CharField(default='Nigeria', max_length=100)),
                ('landmark', models.CharField(blank=True, help_text='Nearest landmark to residential address', max_length=200)),
                ('location', models.CharField(blank=True, choices=[('rural', 'Rural'), ('semi_urban', 'Semi Urban'), ('urban', 'Urban')], help_text='Residential area classification', max_length=20)),
                ('id_type', models.CharField(choices=[('national_id', 'National ID'), ('passport', 'International Passport'), ('drivers_license', "Driver's License"), ('voters_card', "Voter's Card")], max_length=50)),
                ('id_number', models.CharField(max_length=50)),
                ('bvn', models.CharField(blank=True, max_length=11)),
                ('profile_picture', cloudinary.models.CloudinaryField(blank=True, max_length=255, null=True, verbose_name='profile_picture')),
                ('id_card_front', cloudinary.models.CloudinaryField(blank=True, max_length=255, null=True, verbose_name='id_card_front')),
                ('id_card_back', cloudinary.models.CloudinaryField(blank=True, max_length=255, null=True, verbose_name='id_card_back')),
                ('signature', cloudinary.models.CloudinaryField(blank=True, max_length=255, null=True, verbose_name='signature_image')),
                ('occupation', models.CharField(blank=True, max_length=100)),
                ('employer', models.CharField(blank=True, max_length=100)),
                ('monthly_income', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('business_name', models.CharField(blank=True, max_length=200)),
                ('business_type', models.CharField(blank=True, max_length=100)),
                ('business_location', models.TextField(blank=True)),
                ('years_in_business', models.IntegerField(blank=True, null=True, validators=[django.core.validators.MinValueValidator(0)])),
                ('business_type_2', models.CharField(blank=True, help_text='Secondary business type, if any', max_length=100)),
                ('business_address', models.TextField(blank=True, help_text='Business premises address')),
                ('business_landmark', models.CharField(blank=True, help_text='Nearest landmark to business address', max_length=200)),
                ('account_number', models.CharField(blank=True, max_length=20)),
                ('bank_name', models.CharField(blank=True, max_length=100)),
                ('emergency_contact_name', models.CharField(blank=True, max_length=200)),
                ('emergency_contact_phone', models.CharField(blank=True, max_length=17, validators=[django.core.validators.RegexValidator(regex='^\\+?1?\\d{9,15}$')])),
                ('emergency_contact_relationship', models.CharField(blank=True, max_length=100)),
                ('emergency_contact_address', models.TextField(blank=True)),
                ('union_location', models.CharField(blank=True, max_length=200)),
                ('group_role', models.CharField(blank=True, choices=[('member', 'Member'), ('secretary', 'Secretary'), ('leader', 'Leader')], default='member', help_text='Role within assigned client group', max_length=20)),
                ('level', models.CharField(choices=[('bronze', 'Bronze - Up to ₦50,000'), ('silver', 'Silver - Up to ₦100,000'), ('gold', 'Gold - Up to ₦500,000'), ('platinum', 'Platinum - Up to ₦1,000,000'), ('diamond', 'Diamond - Up to ₦5,000,000')], db_index=True, default='bronze', max_length=20)),
                ('credit_score', models.IntegerField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(1000)])),
                ('risk_rating', models.CharField(choices=[('low', 'Low Risk'), ('medium', 'Medium Risk'), ('high', 'High Risk')], default='medium', max_length=20)),
                ('origin_channel', models.CharField(blank=True, choices=[('NONE', 'None'), ('referral', 'Referral'), ('walk_in', 'Walk-in'), ('online', 'Online'), ('advertisement', 'Advertisement'), ('group_member', 'Group Member Referral'), ('staff_referral', 'Staff Referral'), ('other', 'Other')], default='NONE', help_text='How this client was acquired', max_length=100)),
                ('registration_fee_paid', models.BooleanField(db_index=True, default=False)),
                ('closed_at', models.DateTimeField(blank=True, help_text='Timestamp when the client account was closed', null=True)),
                ('notes', models.TextField(blank=True)),
                ('approved_by', models.ForeignKey(blank=True, help_text='User who approved this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_approved', to=settings.AUTH_USER_MODEL)),
                ('assigned_staff', models.ForeignKey(blank=True, help_text='Currently assigned loan officer', limit_choices_to={'user_role': 'staff'}, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assigned_clients', to=settings.AUTH_USER_MODEL)),
                ('branch', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='clients', to='core.branch')),
                ('deactivated_by', models.ForeignKey(blank=True, help_text='User who deactivated this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deactivated', to=settings.AUTH_USER_MODEL)),
                ('original_officer', models.ForeignKey(blank=True, help_text='Original loan officer who registered this client', limit_choices_to={'user_role__in': ['staff', 'manager']}, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='originally_assigned_clients', to=settings.AUTH_USER_MODEL)),
                ('group', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='members', to='core.clientgroup')),
            ],
            options={
                'verbose_name': 'Client',
                'verbose_name_plural': 'Clients',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='AssignmentRequest',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('approval_status', models.CharField(choices=[('draft', 'Draft'), ('pending', 'Pending Approval'), ('approved', 'Approved'), ('rejected', 'Rejected')], db_index=True, default='draft', max_length=20)),
                ('approved_at', models.DateTimeField(blank=True, help_text='When this record was approved', null=True)),
                ('rejection_reason', models.TextField(blank=True, help_text='Reason for rejection')),
                ('assignment_type', models.CharField(choices=[('client_to_staff', 'Assign Client to Staff'), ('client_to_branch', 'Assign Client to Branch'), ('client_to_group', 'Assign Client to Group'), ('group_to_staff', 'Assign Group to Staff'), ('group_to_branch', 'Assign Group to Branch'), ('bulk_clients_to_staff', 'Bulk Assign Clients to Staff'), ('bulk_clients_to_branch', 'Bulk Assign Clients to Branch'), ('bulk_clients_to_group', 'Bulk Assign Clients to Group'), ('unassign_client_from_staff', 'Unassign Client from Staff'), ('unassign_client_from_branch', 'Unassign Client from Branch'), ('unassign_client_from_group', 'Unassign Client from Group')], help_text='Type of assignment being requested', max_length=50)),
                ('status', models.CharField(choices=[('pending', 'Pending Approval'), ('approved', 'Approved'), ('rejected', 'Rejected'), ('cancelled', 'Cancelled')], db_index=True, default='pending', max_length=20)),
                ('assignment_data', models.JSONField(help_text='JSON data containing assignment details')),
                ('description', models.TextField(help_text='Human-readable description of the assignment request')),
                ('reason', models.TextField(blank=True, help_text='Reason for the assignment (optional)')),
                ('affected_count', models.IntegerField(default=1, help_text='Number of clients/members affected')),
                ('reviewed_at', models.DateTimeField(blank=True, null=True)),
                ('review_notes', models.TextField(blank=True)),
                ('executed_at', models.DateTimeField(blank=True, null=True)),
                ('execution_result', models.JSONField(blank=True, null=True)),
                ('expires_at', models.DateTimeField(blank=True, null=True)),
                ('approved_by', models.ForeignKey(blank=True, help_text='User who approved this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_approved', to=settings.AUTH_USER_MODEL)),
                ('requested_by', models.ForeignKey(help_text='User who created this assignment request', on_delete=django.db.models.deletion.CASCADE, related_name='assignment_requests_created', to=settings.AUTH_USER_MODEL)),
                ('reviewed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assignment_requests_reviewed', to=settings.AUTH_USER_MODEL)),
                ('target_staff', models.ForeignKey(blank=True, limit_choices_to={'user_role__in': ['staff', 'manager']}, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assignment_requests_as_target_staff', to=settings.AUTH_USER_MODEL)),
                ('branch', models.ForeignKey(blank=True, help_text='Branch of the requester (for filtering)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assignment_requests', to='core.branch')),
                ('target_branch', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assignment_requests_as_target_branch', to='core.branch')),
                ('target_group', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='assignment_requests_as_target_group', to='core.clientgroup')),
            ],
            options={
                'verbose_name': 'Assignment Request',
                'verbose_name_plural': 'Assignment Requests',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='GroupCollectionSession',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('collection_date', models.DateField(help_text='Date when collections were made')),
                ('total_amount', models.DecimalField(decimal_places=2, help_text='Total amount collected in this session', max_digits=15)),
                ('status', models.CharField(choices=[('pending', 'Pending Approval'), ('approved', 'Approved'), ('rejected', 'Rejected')], db_index=True, default='pending', max_length=20)),
                ('notes', models.TextField(blank=True, help_text='Additional notes about the collection session')),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('rejected_at', models.DateTimeField(blank=True, null=True)),
                ('rejection_reason', models.TextField(blank=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='approved_collection_sessions', to=settings.AUTH_USER_MODEL)),
                ('collected_by', models.ForeignKey(help_text='Staff member who collected the payments', on_delete=django.db.models.deletion.PROTECT, related_name='collection_sessions', to=settings.AUTH_USER_MODEL)),
                ('group', models.ForeignKey(help_text='The client group this collection is for', on_delete=django.db.models.deletion.CASCADE, related_name='collection_sessions', to='core.clientgroup')),
                ('rejected_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='rejected_collection_sessions', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-collection_date', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='GroupSavingsCollectionSession',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('collection_date', models.DateField()),
                ('total_amount', models.DecimalField(decimal_places=2, max_digits=15)),
                ('status', models.CharField(choices=[('pending', 'Pending Approval'), ('approved', 'Approved'), ('rejected', 'Rejected')], db_index=True, default='pending', max_length=20)),
                ('notes', models.TextField(blank=True)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('rejected_at', models.DateTimeField(blank=True, null=True)),
                ('rejection_reason', models.TextField(blank=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='approved_savings_sessions', to=settings.AUTH_USER_MODEL)),
                ('collected_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='savings_collection_sessions', to=settings.AUTH_USER_MODEL)),
                ('group', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='savings_collection_sessions', to='core.clientgroup')),
                ('rejected_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='rejected_savings_sessions', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-collection_date', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='JournalEntry',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('journal_number', models.CharField(db_index=True, help_text='Unique journal number', max_length=50, unique=True)),
                ('entry_type', models.CharField(choices=[('manual', 'Manual Entry'), ('automatic', 'System Generated'), ('loan_disbursement', 'Loan Disbursement'), ('loan_repayment', 'Loan Repayment'), ('savings_deposit', 'Savings Deposit'), ('savings_withdrawal', 'Savings Withdrawal'), ('fee_collection', 'Fee Collection'), ('reversal', 'Reversal Entry'), ('adjustment', 'Adjustment Entry')], max_length=30)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('pending', 'Pending Approval'), ('posted', 'Posted'), ('reversed', 'Reversed'), ('rejected', 'Rejected')], db_index=True, default='draft', max_length=20)),
                ('transaction_date', models.DateField(db_index=True, help_text='Date of the transaction')),
                ('posting_date', models.DateField(blank=True, help_text='Date when journal was posted (locked)', null=True)),
                ('description', models.TextField(help_text='Journal entry description/narration')),
                ('reference_number', models.CharField(blank=True, help_text='External reference', max_length=100)),
                ('posted_at', models.DateTimeField(blank=True, null=True)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_journals', to=settings.AUTH_USER_MODEL)),
                ('branch', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='journal_entries', to='core.branch')),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='created_journals', to=settings.AUTH_USER_MODEL)),
                ('posted_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='posted_journals', to=settings.AUTH_USER_MODEL)),
                ('reversed_entry', models.ForeignKey(blank=True, help_text='Original entry that this reversal applies to', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='reversals', to='core.journalentry')),
            ],
            options={
                'verbose_name': 'Journal Entry',
                'verbose_name_plural': 'Journal Entries',
                'ordering': ['-transaction_date', '-journal_number'],
            },
        ),
        migrations.CreateModel(
            name='JournalEntryLine',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('debit_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Debit amount (leave 0 if credit)', max_digits=15)),
                ('credit_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Credit amount (leave 0 if debit)', max_digits=15)),
                ('description', models.TextField(blank=True)),
                ('account', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='journal_lines', to='core.chartofaccounts')),
                ('client', models.ForeignKey(blank=True, help_text='Client reference (optional)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='journal_lines', to='core.client')),
                ('journal_entry', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='lines', to='core.journalentry')),
            ],
            options={
                'verbose_name': 'Journal Entry Line',
                'verbose_name_plural': 'Journal Entry Lines',
                'ordering': ['id'],
            },
        ),
        migrations.CreateModel(
            name='Loan',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('loan_number', models.CharField(db_index=True, help_text='Auto-generated loan number', max_length=50, unique=True)),
                ('principal_amount', models.DecimalField(decimal_places=2, max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('1000.00'))])),
                ('duration_months', models.IntegerField(validators=[django.core.validators.MinValueValidator(1), django.core.validators.MaxValueValidator(36)])),
                ('interest_type', models.CharField(choices=[('flat', 'Flat Rate'), ('reducing_balance', 'Reducing Balance')], default='flat', help_text='How interest is calculated on this loan', max_length=20)),
                ('monthly_interest_rate', models.DecimalField(decimal_places=4, default=Decimal('0.0350'), max_digits=5)),
                ('apr', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Annual Percentage Rate (e.g. 80.68)', max_digits=7, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('eir', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Effective Interest Rate (e.g. 123.18)', max_digits=7, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('total_interest', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('total_repayment', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('installment_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('number_of_installments', models.IntegerField(default=0)),
                ('purpose', models.CharField(max_length=200)),
                ('purpose_details', models.TextField(blank=True, null=True)),
                ('loan_sector', models.CharField(blank=True, help_text='Sector / industry the loan is for (e.g. Agriculture, Retail)', max_length=200)),
                ('loan_cycle', models.PositiveIntegerField(default=1, help_text='Which loan cycle this is for the client (1st loan = 1, 2nd = 2 …)')),
                ('risk_premium_fee', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('rp_income_fee', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('tech_fee', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('loan_form_fee', models.DecimalField(decimal_places=2, default=Decimal('200.00'), max_digits=15)),
                ('total_upfront_fees', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('fees_paid', models.BooleanField(db_index=True, default=False)),
                ('fees_paid_date', models.DateTimeField(blank=True, null=True)),
                ('amount_paid', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('outstanding_balance', models.DecimalField(db_index=True, decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('amount_disbursed', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15)),
                ('last_payment_amount', models.DecimalField(blank=True, decimal_places=2, help_text='Amount of the most recent repayment', max_digits=15, null=True)),
                ('last_payment_date', models.DateField(blank=True, help_text='Date of the most recent repayment', null=True)),
                ('timely_repayments_pct', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Percentage of installments paid on or before due date', max_digits=5, validators=[django.core.validators.MinValueValidator(Decimal('0.00')), django.core.validators.MaxValueValidator(Decimal('100.00'))])),
                ('status', models.CharField(choices=[('pending_fees', 'Pending Fee Payment'), ('pending_approval', 'Pending Approval'), ('approved', 'Approved'), ('rejected', 'Rejected'), ('disbursed', 'Disbursed'), ('active', 'Active'), ('completed', 'Completed'), ('overdue', 'Overdue'), ('written_off', 'Written Off')], db_index=True, default='pending_fees', max_length=20)),
                ('application_date', models.DateTimeField(auto_now_add=True)),
                ('approval_date', models.DateTimeField(blank=True, null=True)),
                ('disbursement_date', models.DateTimeField(blank=True, null=True)),
                ('completion_date', models.DateTimeField(blank=True, null=True)),
                ('first_repayment_date', models.DateField(blank=True, null=True)),
                ('final_repayment_date', models.DateField(blank=True, null=True)),
                ('next_repayment_date', models.DateField(blank=True, db_index=True, null=True)),
                ('disbursement_method', models.CharField(blank=True, choices=[('bank_transfer', 'Bank Transfer'), ('cash', 'Cash'), ('mobile_money', 'Mobile Money'), ('cheque', 'Cheque')], max_length=20, null=True)),
                ('bank_name', models.CharField(blank=True, max_length=200, null=True)),
                ('bank_account_number', models.CharField(blank=True, max_length=50, null=True)),
                ('bank_account_name', models.CharField(blank=True, max_length=200, null=True)),
                ('disbursement_reference', models.CharField(blank=True, max_length=100, null=True)),
                ('disbursement_notes', models.TextField(blank=True, null=True)),
                ('rejection_reason', models.TextField(blank=True, null=True)),
                ('client_signature', cloudinary.models.CloudinaryField(blank=True, help_text="Client's signature on the loan agreement", max_length=255, null=True, verbose_name='client_signature')),
                ('union_leader_name', models.CharField(blank=True, help_text='Full name of the group leader', max_length=200)),
                ('union_leader_signature', cloudinary.models.CloudinaryField(blank=True, help_text="Group leader's signature", max_length=255, null=True, verbose_name='union_leader_signature')),
                ('union_secretary_name', models.CharField(blank=True, help_text='Full name of the group secretary', max_length=200)),
                ('union_secretary_signature', cloudinary.models.CloudinaryField(blank=True, help_text="Group secretary's signature", max_length=255, null=True, verbose_name='union_secretary_signature')),
                ('union_member1_name', models.CharField(blank=True, help_text='Group member 1 name', max_length=200)),
                ('union_member1_signature', cloudinary.models.CloudinaryField(blank=True, help_text='Group member 1 signature', max_length=255, null=True, verbose_name='union_member1_signature')),
                ('union_member2_name', models.CharField(blank=True, help_text='Group member 2 name', max_length=200)),
                ('union_member2_signature', cloudinary.models.CloudinaryField(blank=True, help_text='Group member 2 signature', max_length=255, null=True, verbose_name='union_member2_signature')),
                ('union_member3_name', models.CharField(blank=True, help_text='Group member 3 name', max_length=200)),
                ('union_member3_signature', cloudinary.models.CloudinaryField(blank=True, help_text='Group member 3 signature', max_length=255, null=True, verbose_name='union_member3_signature')),
                ('credit_officer_signature', cloudinary.models.CloudinaryField(blank=True, help_text='Signature of the credit / loan officer who processed this loan', max_length=255, null=True, verbose_name='credit_officer_signature')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='loans_approved', to=settings.AUTH_USER_MODEL)),
                ('branch', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='loans', to='core.branch')),
                ('client', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='loans', to='core.client')),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='loans_created', to=settings.AUTH_USER_MODEL)),
                ('disbursed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='loans_disbursed', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Loan',
                'verbose_name_plural': 'Loans',
                'ordering': ['-application_date'],
            },
        ),
        migrations.AddField(
            model_name='journalentry',
            name='loan',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='journal_entries', to='core.loan'),
        ),
        migrations.CreateModel(
            name='Guarantor',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('guarantor_type', models.CharField(choices=[('internal', 'Internal'), ('external', 'External')], default='external', help_text='Internal = existing client; External = outside person', max_length=20)),
                ('guarantee_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Amount this guarantor is guaranteeing', max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('name', models.CharField(max_length=255)),
                ('phone', models.CharField(max_length=17, validators=[django.core.validators.RegexValidator(regex='^\\+?1?\\d{9,15}$')])),
                ('email', models.EmailField(blank=True, max_length=254)),
                ('relationship', models.CharField(help_text='Relationship to the loan client', max_length=100)),
                ('address', models.TextField()),
                ('occupation', models.CharField(blank=True, max_length=100)),
                ('employer', models.CharField(blank=True, max_length=100)),
                ('monthly_income', models.DecimalField(blank=True, decimal_places=2, max_digits=12, null=True, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('id_type', models.CharField(blank=True, max_length=50)),
                ('id_number', models.CharField(blank=True, max_length=50)),
                ('notes', models.TextField(blank=True)),
                ('branch', models.ForeignKey(blank=True, help_text='Branch associated with the guarantor', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='guarantors', to='core.branch')),
                ('linked_client', models.ForeignKey(blank=True, help_text='Linked client record (only for Internal guarantors)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='guarantor_records', to='core.client')),
                ('loan', models.ForeignKey(help_text='The loan this guarantor is guaranteeing', on_delete=django.db.models.deletion.CASCADE, related_name='guarantors', to='core.loan')),
            ],
            options={
                'verbose_name': 'Guarantor',
                'verbose_name_plural': 'Guarantors',
                'ordering': ['created_at'],
            },
        ),
        migrations.CreateModel(
            name='GroupCollectionItem',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('amount', models.DecimalField(decimal_places=2, help_text='Amount collected for this loan', max_digits=15)),
                ('notes', models.CharField(blank=True, help_text='Notes for this specific collection', max_length=255)),
                ('session', models.ForeignKey(help_text='The collection session this item belongs to', on_delete=django.db.models.deletion.CASCADE, related_name='items', to='core.groupcollectionsession')),
                ('loan', models.ForeignKey(help_text='The loan being paid', on_delete=django.db.models.deletion.PROTECT, related_name='group_collection_items', to='core.loan')),
            ],
            options={
                'ordering': ['created_at'],
            },
        ),
        migrations.CreateModel(
            name='FollowUpTask',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('follow_up_type', models.CharField(choices=[('phone_call', 'Phone Call'), ('sms', 'SMS'), ('visit', 'Client Visit'), ('email', 'Email'), ('whatsapp', 'WhatsApp'), ('meeting', 'Office Meeting')], max_length=20)),
                ('priority', models.CharField(choices=[('low', 'Low'), ('medium', 'Medium'), ('high', 'High'), ('urgent', 'Urgent')], default='medium', max_length=10)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('completed', 'Completed'), ('cancelled', 'Cancelled')], db_index=True, default='pending', max_length=20)),
                ('due_date', models.DateField(db_index=True)),
                ('completed_at', models.DateTimeField(blank=True, null=True)),
                ('notes', models.TextField(help_text='Details about what needs to be done')),
                ('outcome', models.TextField(blank=True, help_text='What happened when the follow-up was completed')),
                ('assigned_to', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='assigned_followups', to=settings.AUTH_USER_MODEL)),
                ('created_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='created_followups', to=settings.AUTH_USER_MODEL)),
                ('loan', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='followup_tasks', to='core.loan')),
            ],
            options={
                'ordering': ['due_date', '-priority'],
            },
        ),
        migrations.CreateModel(
            name='Collateral',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('collateral_type', models.CharField(choices=[('land', 'Land'), ('building', 'Building / Property'), ('vehicle', 'Vehicle'), ('equipment', 'Equipment / Machinery'), ('inventory', 'Inventory / Stock'), ('bank_guarantee', 'Bank Guarantee'), ('insurance_policy', 'Insurance Policy'), ('other', 'Other')], help_text='Type / category of the collateral', max_length=30)),
                ('description', models.TextField(help_text='Description of the collateral item')),
                ('value', models.DecimalField(decimal_places=2, help_text='Estimated / appraised value of the collateral', max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('owner_name', models.CharField(blank=True, help_text='Name of the collateral owner', max_length=200)),
                ('owner_phone', models.CharField(blank=True, help_text='Owner phone number', max_length=17)),
                ('owner_address', models.TextField(blank=True, help_text='Owner address')),
                ('location', models.TextField(blank=True, help_text='Physical location / address of the collateral')),
                ('document', cloudinary.models.CloudinaryField(blank=True, help_text='Supporting document (receipt, title deed, etc.)', max_length=255, null=True, verbose_name='collateral_document')),
                ('photo', cloudinary.models.CloudinaryField(blank=True, help_text='Photo of the collateral item', max_length=255, null=True, verbose_name='collateral_photo')),
                ('status', models.CharField(choices=[('pending', 'Pending Verification'), ('verified', 'Verified'), ('rejected', 'Rejected'), ('released', 'Released')], db_index=True, default='pending', max_length=20)),
                ('verified_at', models.DateTimeField(blank=True, null=True)),
                ('notes', models.TextField(blank=True)),
                ('verified_by', models.ForeignKey(blank=True, help_text='Staff who verified this collateral', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='verified_collaterals', to=settings.AUTH_USER_MODEL)),
                ('loan', models.ForeignKey(help_text='The loan this collateral secures', on_delete=django.db.models.deletion.CASCADE, related_name='collaterals', to='core.loan')),
            ],
            options={
                'verbose_name': 'Collateral',
                'verbose_name_plural': 'Collaterals',
                'ordering': ['created_at'],
            },
        ),
        migrations.CreateModel(
            name='LoanNote',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('note_type', models.CharField(choices=[('loan_transaction_note', 'Loan Transaction Note'), ('collection_note', 'Collection Note'), ('general', 'General Note'), ('follow_up', 'Follow-Up Note'), ('approval', 'Approval Note'), ('disbursement', 'Disbursement Note'), ('restructure', 'Restructure Note'), ('other', 'Other')], db_index=True, default='general', help_text='Category / type of this note', max_length=40)),
                ('note', models.TextField(help_text='The note content')),
                ('created_by', models.ForeignKey(help_text='Staff member who wrote this note', on_delete=django.db.models.deletion.PROTECT, related_name='loan_notes_created', to=settings.AUTH_USER_MODEL)),
                ('loan', models.ForeignKey(help_text='The loan this note belongs to', on_delete=django.db.models.deletion.CASCADE, related_name='notes', to='core.loan')),
            ],
            options={
                'verbose_name': 'Loan Note',
                'verbose_name_plural': 'Loan Notes',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='LoanPenalty',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('penalty_type', models.CharField(choices=[('late_payment', 'Late Payment'), ('missed_payment', 'Missed Payment'), ('early_settlement', 'Early Settlement'), ('other', 'Other')], max_length=20)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.01'))])),
                ('reason', models.TextField()),
                ('is_paid', models.BooleanField(default=False)),
                ('is_waived', models.BooleanField(default=False)),
                ('paid_date', models.DateField(blank=True, null=True)),
                ('waived_date', models.DateField(blank=True, null=True)),
                ('waiver_reason', models.TextField(blank=True)),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_penalties', to=settings.AUTH_USER_MODEL)),
                ('loan', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='penalties', to='core.loan')),
                ('waived_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='waived_penalties', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Loan Penalty',
                'verbose_name_plural': 'Loan Penalties',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='LoanProduct',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('is_active', models.BooleanField(db_index=True, default=True, help_text='Is this record active?')),
                ('deactivated_at', models.DateTimeField(blank=True, help_text='When this record was deactivated', null=True)),
                ('deactivation_reason', models.TextField(blank=True, help_text='Reason for deactivation')),
                ('code', models.CharField(db_index=True, help_text='Product code (e.g., THR-STD, BUS-001)', max_length=20, unique=True)),
                ('name', models.CharField(help_text="Product name (e.g., 'Thrift Loan - Standard')", max_length=200)),
                ('description', models.TextField(blank=True)),
                ('loan_type', models.CharField(choices=[('thrift', 'Thrift Loan (Daily Repayment)'), ('group', 'Group Loan (Weekly Repayment)'), ('med', 'MED Loan (Monthly Repayment)'), ('business', 'Business Loan (Monthly Repayment)'), ('emergency', 'Emergency Loan (Weekly Repayment)'), ('salary_advance', 'Salary Advance (Monthly Repayment)'), ('asset_finance', 'Asset Finance Loan'), ('agricultural', 'Agricultural Loan')], db_index=True, help_text='Type of loan product', max_length=20)),
                ('gl_code', models.CharField(blank=True, help_text='GL code for accounting', max_length=10)),
                ('monthly_interest_rate', models.DecimalField(decimal_places=4, default=Decimal('0.035'), help_text='Monthly interest rate (e.g., 0.0350 = 3.5%)', max_digits=5, validators=[django.core.validators.MinValueValidator(Decimal('0.0001'))])),
                ('annual_interest_rate', models.DecimalField(decimal_places=2, default=Decimal('42.00'), help_text='Annual interest rate', max_digits=5, validators=[django.core.validators.MinValueValidator(Decimal('0.01'))])),
                ('interest_calculation_method', models.CharField(choices=[('flat', 'Flat Rate'), ('reducing_balance', 'Reducing Balance')], default='flat', max_length=20)),
                ('risk_premium_enabled', models.BooleanField(default=True)),
                ('risk_premium_rate', models.DecimalField(decimal_places=4, default=Decimal('0.0150'), max_digits=5, validators=[django.core.validators.MinValueValidator(Decimal('0.0000'))])),
                ('risk_premium_calculation', models.CharField(choices=[('percentage', 'Percentage of Principal'), ('flat', 'Flat Amount')], default='percentage', max_length=20)),
                ('rp_income_enabled', models.BooleanField(default=True)),
                ('rp_income_rate', models.DecimalField(decimal_places=4, default=Decimal('0.0150'), max_digits=5, validators=[django.core.validators.MinValueValidator(Decimal('0.0000'))])),
                ('rp_income_calculation', models.CharField(choices=[('percentage', 'Percentage of Principal'), ('flat', 'Flat Amount')], default='percentage', max_length=20)),
                ('tech_fee_enabled', models.BooleanField(default=True)),
                ('tech_fee_rate', models.DecimalField(decimal_places=4, default=Decimal('0.0050'), max_digits=5, validators=[django.core.validators.MinValueValidator(Decimal('0.0000'))])),
                ('tech_fee_calculation', models.CharField(choices=[('percentage', 'Percentage of Principal'), ('flat', 'Flat Amount')], default='percentage', max_length=20)),
                ('loan_form_fee_enabled', models.BooleanField(default=True)),
                ('loan_form_fee_amount', models.DecimalField(decimal_places=2, default=Decimal('200.00'), max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('min_principal_amount', models.DecimalField(decimal_places=2, default=Decimal('10000.00'), max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('1.00'))])),
                ('max_principal_amount', models.DecimalField(decimal_places=2, default=Decimal('500000.00'), max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('1.00'))])),
                ('min_duration_months', models.IntegerField(default=1, validators=[django.core.validators.MinValueValidator(1)])),
                ('max_duration_months', models.IntegerField(default=24, validators=[django.core.validators.MinValueValidator(1)])),
                ('allow_early_repayment', models.BooleanField(default=True)),
                ('early_repayment_penalty_rate', models.DecimalField(decimal_places=4, default=Decimal('0.0000'), max_digits=5, validators=[django.core.validators.MinValueValidator(Decimal('0.0000'))])),
                ('grace_period_days', models.IntegerField(default=0, validators=[django.core.validators.MinValueValidator(0)])),
                ('requires_collateral', models.BooleanField(default=False)),
                ('min_collateral_value_ratio', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=5, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('required_guarantors', models.IntegerField(default=2, validators=[django.core.validators.MinValueValidator(0)])),
                ('requires_insurance', models.BooleanField(default=True)),
                ('min_client_age', models.IntegerField(default=18, validators=[django.core.validators.MinValueValidator(18)])),
                ('max_client_age', models.IntegerField(default=65, validators=[django.core.validators.MinValueValidator(18)])),
                ('requires_business', models.BooleanField(default=False)),
                ('min_membership_months', models.IntegerField(default=0, validators=[django.core.validators.MinValueValidator(0)])),
                ('auto_approve_under_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('requires_director_approval', models.BooleanField(default=False)),
                ('is_featured', models.BooleanField(default=False)),
                ('display_order', models.IntegerField(default=0)),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='loan_products_created', to=settings.AUTH_USER_MODEL)),
                ('deactivated_by', models.ForeignKey(blank=True, help_text='User who deactivated this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deactivated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Loan Product',
                'verbose_name_plural': 'Loan Products',
                'ordering': ['display_order', 'name'],
            },
        ),
        migrations.AddField(
            model_name='loan',
            name='loan_product',
            field=models.ForeignKey(help_text='Loan product (defines type, rates, fees)', on_delete=django.db.models.deletion.PROTECT, related_name='loans', to='core.loanproduct'),
        ),
        migrations.CreateModel(
            name='LoanRepaymentSchedule',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('installment_number', models.IntegerField(help_text='Installment sequence number')),
                ('due_date', models.DateField(db_index=True)),
                ('principal_amount', models.DecimalField(decimal_places=2, max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('interest_amount', models.DecimalField(decimal_places=2, max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('total_amount', models.DecimalField(decimal_places=2, max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('amount_paid', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('outstanding_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('partial', 'Partially Paid'), ('paid', 'Paid'), ('overdue', 'Overdue'), ('waived', 'Waived')], db_index=True, default='pending', max_length=20)),
                ('paid_date', models.DateField(blank=True, null=True)),
                ('penalty_amount', models.DecimalField(decimal_places=2, default=Decimal('0.00'), max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('notes', models.TextField(blank=True)),
                ('loan', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='repayment_schedule', to='core.loan')),
            ],
            options={
                'verbose_name': 'Loan Repayment Schedule',
                'verbose_name_plural': 'Loan Repayment Schedules',
                'ordering': ['loan', 'installment_number'],
            },
        ),
        migrations.CreateModel(
            name='LoanRestructureRequest',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('approval_status', models.CharField(choices=[('draft', 'Draft'), ('pending', 'Pending Approval'), ('approved', 'Approved'), ('rejected', 'Rejected')], db_index=True, default='draft', max_length=20)),
                ('approved_at', models.DateTimeField(blank=True, help_text='When this record was approved', null=True)),
                ('rejection_reason', models.TextField(blank=True, help_text='Reason for rejection')),
                ('restructure_type', models.CharField(choices=[('extend_duration', 'Extend Duration'), ('reduce_installment', 'Reduce Installment'), ('payment_holiday', 'Payment Holiday'), ('capitalize_arrears', 'Capitalize Arrears')], max_length=30)),
                ('current_duration', models.IntegerField(help_text='Current loan duration in months')),
                ('current_installment', models.DecimalField(decimal_places=2, help_text='Current installment amount', max_digits=15)),
                ('proposed_duration', models.IntegerField(blank=True, help_text='Proposed loan duration in months', null=True)),
                ('proposed_installment', models.DecimalField(blank=True, decimal_places=2, help_text='Proposed installment amount', max_digits=15, null=True)),
                ('reason', models.TextField(help_text='Reason for restructuring request')),
                ('approved_by', models.ForeignKey(blank=True, help_text='User who approved this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_approved', to=settings.AUTH_USER_MODEL)),
                ('loan', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='restructure_requests', to='core.loan')),
                ('requested_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='restructure_requests', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='NextOfKin',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('name', models.CharField(max_length=255)),
                ('phone', models.CharField(max_length=17, validators=[django.core.validators.RegexValidator(regex='^\\+?1?\\d{9,15}$')])),
                ('email', models.EmailField(blank=True, max_length=254)),
                ('relationship', models.CharField(max_length=100)),
                ('address', models.TextField()),
                ('occupation', models.CharField(blank=True, max_length=100)),
                ('employer', models.CharField(blank=True, max_length=100)),
                ('notes', models.TextField(blank=True)),
                ('client', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='next_of_kin', to='core.client')),
            ],
            options={
                'verbose_name': 'Next of Kin',
                'verbose_name_plural': 'Next of Kin',
            },
        ),
        migrations.CreateModel(
            name='PaymentPromise',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('promised_amount', models.DecimalField(decimal_places=2, help_text='Amount client promised to pay', max_digits=15)),
                ('promise_date', models.DateField(db_index=True, help_text='Date client promised to pay')),
                ('actual_amount_paid', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Actual amount paid (updated when payment received)', max_digits=15)),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('kept', 'Promise Kept'), ('broken', 'Promise Broken'), ('partial', 'Partially Kept')], db_index=True, default='pending', max_length=20)),
                ('notes', models.TextField(blank=True)),
                ('loan', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='payment_promises', to='core.loan')),
                ('recorded_by', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='recorded_promises', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-promise_date'],
            },
        ),
        migrations.CreateModel(
            name='SavingsAccount',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('approval_status', models.CharField(choices=[('draft', 'Draft'), ('pending', 'Pending Approval'), ('approved', 'Approved'), ('rejected', 'Rejected')], db_index=True, default='draft', max_length=20)),
                ('approved_at', models.DateTimeField(blank=True, help_text='When this record was approved', null=True)),
                ('rejection_reason', models.TextField(blank=True, help_text='Reason for rejection')),
                ('account_number', models.CharField(db_index=True, help_text='Auto-generated unique account number', max_length=20, unique=True)),
                ('status', models.CharField(choices=[('pending', 'Pending Approval'), ('active', 'Active'), ('suspended', 'Suspended'), ('closed', 'Closed'), ('matured', 'Matured')], db_index=True, default='pending', help_text='Current account status', max_length=20)),
                ('is_auto_created', models.BooleanField(default=False, help_text='Was this account auto-created during client activation?')),
                ('fixed_deposit_term', models.IntegerField(blank=True, help_text='Term in months for fixed deposits (copied from product at creation)', null=True)),
                ('maturity_date', models.DateField(blank=True, help_text='Maturity date for fixed deposits (calculated at creation)', null=True)),
                ('balance', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Current account balance', max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('minimum_balance', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Minimum balance to maintain (copied from product at creation)', max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('interest_earned', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Total interest earned over lifetime', max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('last_interest_date', models.DateField(blank=True, help_text='Last date interest was calculated/posted', null=True)),
                ('date_opened', models.DateField(auto_now_add=True, help_text='Date account was opened')),
                ('date_closed', models.DateField(blank=True, help_text='Date account was closed', null=True)),
                ('closed_at', models.DateTimeField(blank=True, help_text='Timestamp when account was closed', null=True)),
                ('notes', models.TextField(blank=True, help_text='Internal notes about the account')),
                ('approved_by', models.ForeignKey(blank=True, help_text='User who approved this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_approved', to=settings.AUTH_USER_MODEL)),
                ('branch', models.ForeignKey(help_text='Branch where account was opened', on_delete=django.db.models.deletion.PROTECT, related_name='savings_accounts', to='core.branch')),
                ('client', models.ForeignKey(help_text='Account owner', on_delete=django.db.models.deletion.PROTECT, related_name='savings_accounts', to='core.client')),
                ('closed_by', models.ForeignKey(blank=True, help_text='User who closed the account', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='closed_savings_accounts', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Savings Account',
                'verbose_name_plural': 'Savings Accounts',
                'ordering': ['-date_opened'],
            },
        ),
        migrations.CreateModel(
            name='Notification',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('notification_type', models.CharField(choices=[('client_registered', 'New Client Registered'), ('client_approved', 'Client Approved'), ('loan_applied', 'Loan Application Submitted'), ('loan_fees_paid', 'Loan Fees Paid'), ('loan_approved', 'Loan Approved'), ('loan_rejected', 'Loan Rejected'), ('loan_disbursed', 'Loan Disbursed'), ('loan_overdue', 'Loan Overdue'), ('loan_completed', 'Loan Completed'), ('savings_created', 'Savings Account Created'), ('savings_approved', 'Savings Account Approved'), ('deposit_made', 'Deposit Made'), ('withdrawal_made', 'Withdrawal Made'), ('deposit_pending', 'Deposit Pending Approval'), ('withdrawal_pending', 'Withdrawal Pending Approval'), ('transaction_approved', 'Transaction Approved'), ('transaction_rejected', 'Transaction Rejected'), ('staff_created', 'Staff Account Created'), ('group_created', 'Group Created'), ('system_alert', 'System Alert'), ('assignment_request_pending', 'Assignment Request Pending'), ('assignment_request_approved', 'Assignment Request Approved'), ('assignment_request_rejected', 'Assignment Request Rejected'), ('branch_changed', 'Branch Assignment Updated'), ('group_assigned', 'Group Assignment Updated'), ('group_removed', 'Removed from Group'), ('group_unassigned', 'Group Unassigned from Staff'), ('client_unassigned', 'Client Unassigned'), ('clients_assigned', 'Multiple Clients Assigned')], db_index=True, max_length=50)),
                ('title', models.CharField(max_length=200)),
                ('message', models.TextField()),
                ('is_read', models.BooleanField(db_index=True, default=False)),
                ('read_at', models.DateTimeField(blank=True, null=True)),
                ('is_urgent', models.BooleanField(default=False)),
                ('related_client', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='related_notifications', to='core.client')),
                ('related_loan', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='notifications', to='core.loan')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='notifications', to=settings.AUTH_USER_MODEL)),
                ('related_savings', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='notifications', to='core.savingsaccount')),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddField(
            model_name='loan',
            name='linked_account',
            field=models.ForeignKey(blank=True, help_text='Savings account linked to this loan (shown on Details tab)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='linked_loans', to='core.savingsaccount'),
        ),
        migrations.AddField(
            model_name='journalentry',
            name='savings_account',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='journal_entries', to='core.savingsaccount'),
        ),
        migrations.CreateModel(
            name='GroupSavingsCollectionItem',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=15)),
                ('notes', models.CharField(blank=True, max_length=255)),
                ('client', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='group_savings_items', to='core.client')),
                ('session', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='items', to='core.groupsavingscollectionsession')),
                ('savings_account', models.ForeignKey(help_text='The savings account to credit', on_delete=django.db.models.deletion.PROTECT, related_name='group_collection_items', to='core.savingsaccount')),
            ],
            options={
                'ordering': ['created_at'],
            },
        ),
        migrations.CreateModel(
            name='SavingsProduct',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('is_active', models.BooleanField(db_index=True, default=True, help_text='Is this record active?')),
                ('deactivated_at', models.DateTimeField(blank=True, help_text='When this record was deactivated', null=True)),
                ('deactivation_reason', models.TextField(blank=True, help_text='Reason for deactivation')),
                ('name', models.CharField(help_text="Product name (e.g., 'Basic Savings Account', 'Fixed Deposit 6M')", max_length=100, unique=True)),
                ('code', models.CharField(db_index=True, help_text="Unique product code (e.g., 'REG-SAV', 'FD-6M')", max_length=20, unique=True)),
                ('description', models.TextField(blank=True, help_text='Product description and features')),
                ('gl_code', models.CharField(blank=True, help_text='General Ledger code for accounting', max_length=10)),
                ('product_type', models.CharField(choices=[('regular', 'Regular Savings'), ('fixed', 'Fixed Deposit'), ('target', 'Target Savings'), ('children', 'Children Savings')], db_index=True, default='regular', help_text='Type of savings product - determines ALL account behavior', max_length=20)),
                ('interest_rate_annual', models.DecimalField(decimal_places=2, default=Decimal('5.00'), help_text='Annual interest rate percentage (e.g., 5.00 for 5%)', max_digits=5, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('interest_calculation_method', models.CharField(choices=[('simple', 'Simple Interest'), ('compound', 'Compound Interest')], default='simple', help_text='How interest is calculated', max_length=20)),
                ('interest_payment_frequency', models.CharField(choices=[('monthly', 'Monthly'), ('quarterly', 'Quarterly'), ('annually', 'Annually'), ('maturity', 'At Maturity')], default='monthly', help_text='How often interest is paid out', max_length=20)),
                ('minimum_balance', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Minimum balance that must be maintained', max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('minimum_opening_balance', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Minimum balance required to open account', max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('maximum_balance', models.DecimalField(blank=True, decimal_places=2, help_text='Maximum balance allowed (null = no limit)', max_digits=15, null=True, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('min_deposit_amount', models.DecimalField(decimal_places=2, default=Decimal('100.00'), help_text='Minimum amount per deposit', max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('min_withdrawal_amount', models.DecimalField(decimal_places=2, default=Decimal('100.00'), help_text='Minimum amount per withdrawal', max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('max_withdrawal_amount', models.DecimalField(blank=True, decimal_places=2, help_text='Maximum amount per withdrawal (null = no limit)', max_digits=15, null=True, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('daily_withdrawal_limit', models.DecimalField(blank=True, decimal_places=2, help_text='Total daily withdrawal limit (null = no limit)', max_digits=15, null=True, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('fixed_term_months', models.IntegerField(blank=True, help_text='Fixed term in months (required for fixed deposit products)', null=True, validators=[django.core.validators.MinValueValidator(1)])),
                ('allows_withdrawal_before_maturity', models.BooleanField(default=True, help_text='Can customers withdraw before maturity date?')),
                ('early_withdrawal_penalty_rate', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Penalty rate (%) for early withdrawal from fixed deposits', max_digits=5, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('monthly_maintenance_fee', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Monthly account maintenance fee', max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('withdrawal_fee', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Fee per withdrawal transaction', max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('below_minimum_balance_fee', models.DecimalField(decimal_places=2, default=Decimal('0.00'), help_text='Fee charged when balance falls below minimum', max_digits=10, validators=[django.core.validators.MinValueValidator(Decimal('0.00'))])),
                ('is_featured', models.BooleanField(default=False, help_text='Display prominently on website/app')),
                ('display_order', models.IntegerField(default=0, help_text='Order for displaying products (lower = first)')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='savings_products_created', to=settings.AUTH_USER_MODEL)),
                ('deactivated_by', models.ForeignKey(blank=True, help_text='User who deactivated this record', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_deactivated', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Savings Product',
                'verbose_name_plural': 'Savings Products',
                'ordering': ['display_order', 'name'],
            },
        ),
        migrations.AddField(
            model_name='savingsaccount',
            name='savings_product',
            field=models.ForeignKey(help_text='Savings product - determines ALL account behavior (type, interest, limits, fees)', on_delete=django.db.models.deletion.PROTECT, related_name='accounts', to='core.savingsproduct'),
        ),
        migrations.CreateModel(
            name='Transaction',
            fields=[
                ('id', models.UUIDField(default=uuid.uuid4, editable=False, primary_key=True, serialize=False)),
                ('created_at', models.DateTimeField(auto_now_add=True, db_index=True, help_text='When this record was created')),
                ('updated_at', models.DateTimeField(auto_now=True, help_text='When this record was last updated')),
                ('deleted_at', models.DateTimeField(blank=True, db_index=True, help_text='When this record was soft-deleted (null = not deleted)', null=True)),
                ('transaction_ref', models.CharField(db_index=True, help_text='Auto-generated transaction reference', max_length=50, unique=True)),
                ('transaction_type', models.CharField(choices=[('deposit', 'Savings Deposit'), ('withdrawal', 'Savings Withdrawal'), ('interest_credit', 'Interest Credit'), ('loan_disbursement', 'Loan Disbursement'), ('loan_repayment', 'Loan Repayment'), ('interest_applied', 'Interest Applied'), ('charges_at_disbursement', 'Charges At Disbursement'), ('registration_fee', 'Client Registration Fee'), ('loan_insurance_fee', 'Loan Insurance Fee'), ('loan_form_fee', 'Loan Form Fee'), ('risk_premium', 'Risk Premium Fee'), ('rp_income', 'RP Income Fee'), ('tech_fee', 'Technology Fee'), ('fee', 'Fee / Charge'), ('reversal', 'Reversal'), ('transfer', 'Transfer')], db_index=True, max_length=30)),
                ('status', models.CharField(choices=[('pending', 'Pending Approval'), ('approved', 'Approved'), ('completed', 'Completed'), ('rejected', 'Rejected'), ('failed', 'Failed'), ('reversed', 'Reversed')], db_index=True, default='pending', max_length=20)),
                ('amount', models.DecimalField(decimal_places=2, max_digits=15, validators=[django.core.validators.MinValueValidator(Decimal('0.01'))])),
                ('principal_amount', models.DecimalField(blank=True, decimal_places=2, help_text='Principal portion of a repayment', max_digits=15, null=True)),
                ('interest_amount', models.DecimalField(blank=True, decimal_places=2, help_text='Interest portion of a repayment', max_digits=15, null=True)),
                ('is_income', models.BooleanField(db_index=True, default=False, help_text='Is this an income transaction?')),
                ('payment_details', models.CharField(blank=True, help_text="Freeform payment reference shown in the 'Payment Details' column (e.g. a bank-transfer ref number, 'collection', 'Slo …')", max_length=200)),
                ('balance_before', models.DecimalField(blank=True, decimal_places=2, help_text='Balance before this transaction', max_digits=15, null=True)),
                ('balance_after', models.DecimalField(blank=True, decimal_places=2, help_text='Balance after this transaction', max_digits=15, null=True)),
                ('approved_at', models.DateTimeField(blank=True, null=True)),
                ('rejection_reason', models.TextField(blank=True)),
                ('description', models.TextField(blank=True)),
                ('notes', models.TextField(blank=True)),
                ('transaction_date', models.DateTimeField(db_index=True, default=django.utils.timezone.now)),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_transactions', to=settings.AUTH_USER_MODEL)),
                ('branch', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, related_name='transactions', to='core.branch')),
                ('client', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='transactions', to='core.client')),
                ('loan', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='transactions', to='core.loan')),
                ('processed_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='processed_transactions', to=settings.AUTH_USER_MODEL)),
                ('reversed_transaction', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='reversals', to='core.transaction')),
                ('savings_account', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.PROTECT, related_name='transactions', to='core.savingsaccount')),
            ],
            options={
                'verbose_name': 'Transaction',
                'verbose_name_plural': 'Transactions',
                'ordering': ['-transaction_date'],
            },
        ),
        migrations.AddField(
            model_name='loan',
            name='fees_transaction',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='fee_for_loan', to='core.transaction'),
        ),
        migrations.AddField(
            model_name='journalentry',
            name='transaction',
            field=models.ForeignKey(blank=True, help_text='Source transaction (if system-generated)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='journal_entries', to='core.transaction'),
        ),
        migrations.AddField(
            model_name='client',
            name='registration_fee_transaction',
            field=models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='registration_fee_for', to='core.transaction'),
        ),
        migrations.AddIndex(
            model_name='branch',
            index=models.Index(fields=['code'], name='core_branch_code_b50af7_idx'),
        ),
        migrations.AddIndex(
            model_name='branch',
            index=models.Index(fields=['is_active'], name='core_branch_is_acti_582342_idx'),
        ),
        migrations.AddIndex(
            model_name='branch',
            index=models.Index(fields=['state', 'city'], name='core_branch_state_7877ec_idx'),
        ),
        migrations.AddConstraint(
            model_name='branch',
            constraint=models.CheckConstraint(condition=models.Q(('code', ''), _negated=True), name='branch_code_not_empty'),
        ),
        migrations.AddConstraint(
            model_name='branch',
            constraint=models.UniqueConstraint(condition=models.Q(('deleted_at__isnull', True)), fields=('code',), name='unique_active_branch_code'),
        ),
        migrations.AddIndex(
            model_name='user',
            index=models.Index(fields=['email'], name='core_user_email_38052c_idx'),
        ),
        migrations.AddIndex(
            model_name='user',
            index=models.Index(fields=['user_role', 'is_active'], name='core_user_user_ro_331683_idx'),
        ),
        migrations.AddIndex(
            model_name='user',
            index=models.Index(fields=['employee_id'], name='core_user_employe_506d81_idx'),
        ),
        migrations.AddIndex(
            model_name='user',
            index=models.Index(fields=['is_approved', 'is_active'], name='core_user_is_appr_4580ad_idx'),
        ),
        migrations.AddIndex(
            model_name='user',
            index=models.Index(fields=['branch', 'user_role'], name='core_user_branch__7de3c0_idx'),
        ),
        migrations.AddIndex(
            model_name='user',
            index=models.Index(fields=['hire_date'], name='core_user_hire_da_bed7a8_idx'),
        ),
        migrations.AddConstraint(
            model_name='user',
            constraint=models.CheckConstraint(condition=models.Q(('salary__gte', 0), ('salary__isnull', True), _connector='OR'), name='user_salary_positive'),
        ),
        migrations.AddConstraint(
            model_name='user',
            constraint=models.CheckConstraint(condition=models.Q(('max_approval_amount__gte', 0), ('max_approval_amount__isnull', True), _connector='OR'), name='user_max_approval_positive'),
        ),
        migrations.AddConstraint(
            model_name='user',
            constraint=models.CheckConstraint(condition=models.Q(('failed_login_attempts__gte', 0)), name='user_failed_attempts_positive'),
        ),
        migrations.AddIndex(
            model_name='chartofaccounts',
            index=models.Index(fields=['gl_code'], name='core_charto_gl_code_c7119c_idx'),
        ),
        migrations.AddIndex(
            model_name='chartofaccounts',
            index=models.Index(fields=['account_type'], name='core_charto_account_d59cfc_idx'),
        ),
        migrations.AddIndex(
            model_name='chartofaccounts',
            index=models.Index(fields=['is_active'], name='core_charto_is_acti_f4069c_idx'),
        ),
        migrations.AddConstraint(
            model_name='chartofaccounts',
            constraint=models.UniqueConstraint(condition=models.Q(('deleted_at__isnull', True)), fields=('gl_code',), name='unique_active_gl_code'),
        ),
        migrations.AddIndex(
            model_name='clientgroup',
            index=models.Index(fields=['code'], name='core_client_code_0f78f8_idx'),
        ),
        migrations.AddIndex(
            model_name='clientgroup',
            index=models.Index(fields=['status', 'branch'], name='core_client_status_d3115f_idx'),
        ),
        migrations.AddIndex(
            model_name='clientgroup',
            index=models.Index(fields=['meeting_day'], name='core_client_meeting_3a26ea_idx'),
        ),
        migrations.AddIndex(
            model_name='clientgroup',
            index=models.Index(fields=['loan_officer'], name='core_client_loan_of_60452a_idx'),
        ),
        migrations.AddIndex(
            model_name='clientgroup',
            index=models.Index(fields=['group_type'], name='core_client_group_t_479b52_idx'),
        ),
        migrations.AddConstraint(
            model_name='clientgroup',
            constraint=models.CheckConstraint(condition=models.Q(('total_members__gte', 0)), name='group_total_members_positive'),
        ),
        migrations.AddConstraint(
            model_name='clientgroup',
            constraint=models.CheckConstraint(condition=models.Q(('active_members__gte', 0)), name='group_active_members_positive'),
        ),
        migrations.AddConstraint(
            model_name='clientgroup',
            constraint=models.CheckConstraint(condition=models.Q(('total_savings__gte', 0)), name='group_total_savings_positive'),
        ),
        migrations.AddConstraint(
            model_name='clientgroup',
            constraint=models.CheckConstraint(condition=models.Q(('total_loans_outstanding__gte', 0)), name='group_loans_outstanding_positive'),
        ),
        migrations.AddIndex(
            model_name='assignmentrequest',
            index=models.Index(fields=['status', 'requested_by'], name='core_assign_status_59366e_idx'),
        ),
        migrations.AddIndex(
            model_name='assignmentrequest',
            index=models.Index(fields=['status', 'branch'], name='core_assign_status_8ff3e4_idx'),
        ),
        migrations.AddIndex(
            model_name='assignmentrequest',
            index=models.Index(fields=['assignment_type', 'status'], name='core_assign_assignm_5b9dc1_idx'),
        ),
        migrations.AddIndex(
            model_name='groupcollectionsession',
            index=models.Index(fields=['status', 'collected_by'], name='core_groupc_status_e94429_idx'),
        ),
        migrations.AddIndex(
            model_name='groupcollectionsession',
            index=models.Index(fields=['collection_date'], name='core_groupc_collect_c38576_idx'),
        ),
        migrations.AddIndex(
            model_name='groupcollectionsession',
            index=models.Index(fields=['group', 'collection_date'], name='core_groupc_group_i_f27005_idx'),
        ),
        migrations.AddConstraint(
            model_name='journalentryline',
            constraint=models.CheckConstraint(condition=models.Q(('debit_amount__gte', 0)), name='journalline_debit_positive'),
        ),
        migrations.AddConstraint(
            model_name='journalentryline',
            constraint=models.CheckConstraint(condition=models.Q(('credit_amount__gte', 0)), name='journalline_credit_positive'),
        ),
        migrations.AddIndex(
            model_name='guarantor',
            index=models.Index(fields=['loan'], name='core_guaran_loan_id_d63abf_idx'),
        ),
        migrations.AddIndex(
            model_name='guarantor',
            index=models.Index(fields=['guarantor_type'], name='core_guaran_guarant_d17604_idx'),
        ),
        migrations.AddIndex(
            model_name='guarantor',
            index=models.Index(fields=['branch'], name='core_guaran_branch__d93698_idx'),
        ),
        migrations.AddConstraint(
            model_name='guarantor',
            constraint=models.CheckConstraint(condition=models.Q(('guarantee_amount__gte', 0)), name='guarantor_amount_positive'),
        ),
        migrations.AddIndex(
            model_name='groupcollectionitem',
            index=models.Index(fields=['session', 'loan'], name='core_groupc_session_1a5a94_idx'),
        ),
        migrations.AddIndex(
            model_name='followuptask',
            index=models.Index(fields=['status', 'assigned_to'], name='core_follow_status_aa4b49_idx'),
        ),
        migrations.AddIndex(
            model_name='followuptask',
            index=models.Index(fields=['due_date', 'status'], name='core_follow_due_dat_cfee03_idx'),
        ),
        migrations.AddIndex(
            model_name='collateral',
            index=models.Index(fields=['loan'], name='core_collat_loan_id_1f0447_idx'),
        ),
        migrations.AddIndex(
            model_name='collateral',
            index=models.Index(fields=['collateral_type'], name='core_collat_collate_70d020_idx'),
        ),
        migrations.AddIndex(
            model_name='collateral',
            index=models.Index(fields=['status'], name='core_collat_status_8975af_idx'),
        ),
        migrations.AddConstraint(
            model_name='collateral',
            constraint=models.CheckConstraint(condition=models.Q(('value__gte', 0)), name='collateral_value_positive'),
        ),
        migrations.AddIndex(
            model_name='loannote',
            index=models.Index(fields=['loan', '-created_at'], name='core_loanno_loan_id_3a51a7_idx'),
        ),
        migrations.AddIndex(
            model_name='loannote',
            index=models.Index(fields=['note_type'], name='core_loanno_note_ty_12219b_idx'),
        ),
        migrations.AddIndex(
            model_name='loannote',
            index=models.Index(fields=['created_by'], name='core_loanno_created_8af60d_idx'),
        ),
        migrations.AddIndex(
            model_name='loanproduct',
            index=models.Index(fields=['code'], name='core_loanpr_code_d812c8_idx'),
        ),
        migrations.AddIndex(
            model_name='loanproduct',
            index=models.Index(fields=['is_active'], name='core_loanpr_is_acti_32e640_idx'),
        ),
        migrations.AddIndex(
            model_name='loanproduct',
            index=models.Index(fields=['loan_type', 'is_active'], name='core_loanpr_loan_ty_aafb1d_idx'),
        ),
        migrations.AddIndex(
            model_name='loanproduct',
            index=models.Index(fields=['display_order'], name='core_loanpr_display_139432_idx'),
        ),
        migrations.AddConstraint(
            model_name='loanproduct',
            constraint=models.CheckConstraint(condition=models.Q(('min_principal_amount__lte', models.F('max_principal_amount'))), name='loanproduct_min_max_principal_valid'),
        ),
        migrations.AddConstraint(
            model_name='loanproduct',
            constraint=models.CheckConstraint(condition=models.Q(('min_duration_months__lte', models.F('max_duration_months'))), name='loanproduct_min_max_duration_valid'),
        ),
        migrations.AddConstraint(
            model_name='loanproduct',
            constraint=models.CheckConstraint(condition=models.Q(('monthly_interest_rate__gte', 0)), name='loanproduct_interest_rate_positive'),
        ),
        migrations.AddConstraint(
            model_name='loanproduct',
            constraint=models.CheckConstraint(condition=models.Q(('min_client_age__lte', models.F('max_client_age'))), name='loanproduct_min_max_age_valid'),
        ),
        migrations.AddConstraint(
            model_name='loanproduct',
            constraint=models.UniqueConstraint(condition=models.Q(('deleted_at__isnull', True)), fields=('code',), name='unique_active_loanproduct_code'),
        ),
        migrations.AddIndex(
            model_name='loanrepaymentschedule',
            index=models.Index(fields=['loan', 'status'], name='core_loanre_loan_id_15b48b_idx'),
        ),
        migrations.AddIndex(
            model_name='loanrepaymentschedule',
            index=models.Index(fields=['due_date', 'status'], name='core_loanre_due_dat_a4302f_idx'),
        ),
        migrations.AddConstraint(
            model_name='loanrepaymentschedule',
            constraint=models.CheckConstraint(condition=models.Q(('amount_paid__lte', django.db.models.expressions.CombinedExpression(models.F('total_amount'), '+', models.F('penalty_amount')))), name='schedule_amount_paid_valid'),
        ),
        migrations.AddConstraint(
            model_name='loanrepaymentschedule',
            constraint=models.UniqueConstraint(fields=('loan', 'installment_number'), name='unique_loan_installment'),
        ),
        migrations.AddIndex(
            model_name='notification',
            index=models.Index(fields=['user', 'is_read'], name='core_notifi_user_id_cb8f07_idx'),
        ),
        migrations.AddIndex(
            model_name='notification',
            index=models.Index(fields=['notification_type'], name='core_notifi_notific_cbfe88_idx'),
        ),
        migrations.AddIndex(
            model_name='notification',
            index=models.Index(fields=['is_urgent', 'is_read'], name='core_notifi_is_urge_a21298_idx'),
        ),
        migrations.AddIndex(
            model_name='savingsproduct',
            index=models.Index(fields=['code'], name='core_saving_code_e57dc5_idx'),
        ),
        migrations.AddIndex(
            model_name='savingsproduct',
            index=models.Index(fields=['product_type'], name='core_saving_product_2fb398_idx'),
        ),
        migrations.AddIndex(
            model_name='savingsproduct',
            index=models.Index(fields=['is_active'], name='core_saving_is_acti_d15b41_idx'),
        ),
        migrations.AddIndex(
            model_name='savingsproduct',
            index=models.Index(fields=['display_order'], name='core_saving_display_90d1a2_idx'),
        ),
        migrations.AddConstraint(
            model_name='savingsproduct',
            constraint=models.CheckConstraint(condition=models.Q(('minimum_opening_balance__gte', 0)), name='savingsproduct_min_opening_balance_positive'),
        ),
        migrations.AddConstraint(
            model_name='savingsproduct',
            constraint=models.CheckConstraint(condition=models.Q(('minimum_balance__gte', 0)), name='savingsproduct_min_balance_positive'),
        ),
        migrations.AddConstraint(
            model_name='savingsproduct',
            constraint=models.CheckConstraint(condition=models.Q(('interest_rate_annual__gte', 0)), name='savingsproduct_interest_rate_positive'),
        ),
        migrations.AddConstraint(
            model_name='savingsproduct',
            constraint=models.UniqueConstraint(condition=models.Q(('deleted_at__isnull', True)), fields=('code',), name='unique_active_savingsproduct_code'),
        ),
        migrations.AddIndex(
            model_name='savingsaccount',
            index=models.Index(fields=['account_number'], name='core_saving_account_645a33_idx'),
        ),
        migrations.AddIndex(
            model_name='savingsaccount',
            index=models.Index(fields=['client', 'status'], name='core_saving_client__7da218_idx'),
        ),
        migrations.AddIndex(
            model_name='savingsaccount',
            index=models.Index(fields=['branch', 'status'], name='core_saving_branch__1a92c2_idx'),
        ),
        migrations.AddIndex(
            model_name='savingsaccount',
            index=models.Index(fields=['maturity_date'], name='core_saving_maturit_0c7901_idx'),
        ),
        migrations.AddIndex(
            model_name='savingsaccount',
            index=models.Index(fields=['status', '-date_opened'], name='core_saving_status_a5ff74_idx'),
        ),
        migrations.AddIndex(
            model_name='savingsaccount',
            index=models.Index(fields=['savings_product', 'status'], name='core_saving_savings_8941fc_idx'),
        ),
        migrations.AddConstraint(
            model_name='savingsaccount',
            constraint=models.CheckConstraint(condition=models.Q(('balance__gte', 0)), name='savingsaccount_balance_positive'),
        ),
        migrations.AddConstraint(
            model_name='savingsaccount',
            constraint=models.CheckConstraint(condition=models.Q(('minimum_balance__gte', 0)), name='savingsaccount_min_balance_positive'),
        ),
        migrations.AddConstraint(
            model_name='savingsaccount',
            constraint=models.CheckConstraint(condition=models.Q(('interest_earned__gte', 0)), name='savingsaccount_interest_positive'),
        ),
        migrations.AddConstraint(
            model_name='savingsaccount',
            constraint=models.UniqueConstraint(condition=models.Q(('deleted_at__isnull', True)), fields=('account_number',), name='unique_active_account_number'),
        ),
        migrations.AddIndex(
            model_name='transaction',
            index=models.Index(fields=['transaction_ref'], name='core_transa_transac_22fca0_idx'),
        ),
        migrations.AddIndex(
            model_name='transaction',
            index=models.Index(fields=['transaction_type', 'status'], name='core_transa_transac_348285_idx'),
        ),
        migrations.AddIndex(
            model_name='transaction',
            index=models.Index(fields=['is_income', 'status'], name='core_transa_is_inco_921f08_idx'),
        ),
        migrations.AddIndex(
            model_name='transaction',
            index=models.Index(fields=['status', 'branch'], name='core_transa_status_8fb206_idx'),
        ),
        migrations.AddIndex(
            model_name='transaction',
            index=models.Index(fields=['client', 'transaction_date'], name='core_transa_client__6708cd_idx'),
        ),
        migrations.AddIndex(
            model_name='transaction',
            index=models.Index(fields=['loan', 'transaction_date'], name='core_transa_loan_id_b58c93_idx'),
        ),
        migrations.AddIndex(
            model_name='transaction',
            index=models.Index(fields=['transaction_date'], name='core_transa_transac_ffab81_idx'),
        ),
        migrations.AddConstraint(
            model_name='transaction',
            constraint=models.CheckConstraint(condition=models.Q(('amount__gt', 0)), name='transaction_amount_positive'),
        ),
        migrations.AddConstraint(
            model_name='transaction',
            constraint=models.UniqueConstraint(condition=models.Q(('deleted_at__isnull', True)), fields=('transaction_ref',), name='unique_active_transaction_ref'),
        ),
        migrations.AddIndex(
            model_name='loan',
            index=models.Index(fields=['loan_number'], name='core_loan_loan_nu_706983_idx'),
        ),
        migrations.AddIndex(
            model_name='loan',
            index=models.Index(fields=['status', 'branch'], name='core_loan_status_efac8b_idx'),
        ),
        migrations.AddIndex(
            model_name='loan',
            index=models.Index(fields=['client', 'status'], name='core_loan_client__ea0892_idx'),
        ),
        migrations.AddIndex(
            model_name='loan',
            index=models.Index(fields=['next_repayment_date', 'status'], name='core_loan_next_re_f4f261_idx'),
        ),
        migrations.AddIndex(
            model_name='loan',
            index=models.Index(fields=['disbursement_date'], name='core_loan_disburs_c8a7f5_idx'),
        ),
        migrations.AddIndex(
            model_name='loan',
            index=models.Index(fields=['loan_cycle'], name='core_loan_loan_cy_1b636e_idx'),
        ),
        migrations.AddIndex(
            model_name='loan',
            index=models.Index(fields=['linked_account'], name='core_loan_linked__865a98_idx'),
        ),
        migrations.AddConstraint(
            model_name='loan',
            constraint=models.CheckConstraint(condition=models.Q(('principal_amount__gte', 1000)), name='loan_principal_minimum'),
        ),
        migrations.AddConstraint(
            model_name='loan',
            constraint=models.CheckConstraint(condition=models.Q(('outstanding_balance__gte', 0)), name='loan_outstanding_positive'),
        ),
        migrations.AddConstraint(
            model_name='loan',
            constraint=models.CheckConstraint(condition=models.Q(('amount_paid__gte', 0)), name='loan_amount_paid_positive'),
        ),
        migrations.AddConstraint(
            model_name='loan',
            constraint=models.CheckConstraint(condition=models.Q(('total_upfront_fees__gte', 0)), name='loan_fees_positive'),
        ),
        migrations.AddConstraint(
            model_name='loan',
            constraint=models.CheckConstraint(condition=models.Q(('loan_cycle__gte', 1)), name='loan_cycle_minimum'),
        ),
        migrations.AddConstraint(
            model_name='loan',
            constraint=models.CheckConstraint(condition=models.Q(('apr__gte', 0)), name='loan_apr_positive'),
        ),
        migrations.AddConstraint(
            model_name='loan',
            constraint=models.CheckConstraint(condition=models.Q(('eir__gte', 0)), name='loan_eir_positive'),
        ),
        migrations.AddConstraint(
            model_name='loan',
            constraint=models.CheckConstraint(condition=models.Q(('timely_repayments_pct__gte', 0), ('timely_repayments_pct__lte', 100)), name='loan_timely_repayments_range'),
        ),
        migrations.AddConstraint(
            model_name='loan',
            constraint=models.UniqueConstraint(condition=models.Q(('deleted_at__isnull', True)), fields=('loan_number',), name='unique_active_loan_number'),
        ),
        migrations.AddIndex(
            model_name='journalentry',
            index=models.Index(fields=['journal_number'], name='core_journa_journal_6a96bb_idx'),
        ),
        migrations.AddIndex(
            model_name='journalentry',
            index=models.Index(fields=['transaction_date'], name='core_journa_transac_f842d9_idx'),
        ),
        migrations.AddIndex(
            model_name='journalentry',
            index=models.Index(fields=['status'], name='core_journa_status_bc88b2_idx'),
        ),
        migrations.AddIndex(
            model_name='journalentry',
            index=models.Index(fields=['entry_type'], name='core_journa_entry_t_085be6_idx'),
        ),
        migrations.AddConstraint(
            model_name='journalentry',
            constraint=models.UniqueConstraint(condition=models.Q(('deleted_at__isnull', True)), fields=('journal_number',), name='unique_active_journal_number'),
        ),
        migrations.AddIndex(
            model_name='client',
            index=models.Index(fields=['client_id'], name='core_client_client__6790f9_idx'),
        ),
        migrations.AddIndex(
            model_name='client',
            index=models.Index(fields=['external_id'], name='core_client_externa_d26fdc_idx'),
        ),
        migrations.AddIndex(
            model_name='client',
            index=models.Index(fields=['email'], name='core_client_email_9bd669_idx'),
        ),
        migrations.AddIndex(
            model_name='client',
            index=models.Index(fields=['phone'], name='core_client_phone_e857f7_idx'),
        ),
        migrations.AddIndex(
            model_name='client',
            index=models.Index(fields=['branch', 'is_active'], name='core_client_branch__08d775_idx'),
        ),
        migrations.AddIndex(
            model_name='client',
            index=models.Index(fields=['assigned_staff', 'is_active'], name='core_client_assigne_94af14_idx'),
        ),
        migrations.AddIndex(
            model_name='client',
            index=models.Index(fields=['group', 'is_active'], name='core_client_group_i_21707a_idx'),
        ),
        migrations.AddIndex(
            model_name='client',
            index=models.Index(fields=['group', 'group_role'], name='core_client_group_i_7bdf27_idx'),
        ),
        migrations.AddIndex(
            model_name='client',
            index=models.Index(fields=['level'], name='core_client_level_54fc0e_idx'),
        ),
        migrations.AddIndex(
            model_name='client',
            index=models.Index(fields=['approval_status'], name='core_client_approva_38d554_idx'),
        ),
        migrations.AddIndex(
            model_name='client',
            index=models.Index(fields=['registration_fee_paid'], name='core_client_registr_81fd7f_idx'),
        ),
        migrations.AddIndex(
            model_name='client',
            index=models.Index(fields=['date_of_birth'], name='core_client_date_of_6451f5_idx'),
        ),
        migrations.AddIndex(
            model_name='client',
            index=models.Index(fields=['closed_at'], name='core_client_closed__6e28fa_idx'),
        ),
        migrations.AddIndex(
            model_name='client',
            index=models.Index(fields=['origin_channel'], name='core_client_origin__71f125_idx'),
        ),
        migrations.AddConstraint(
            model_name='client',
            constraint=models.CheckConstraint(condition=models.Q(('monthly_income__gte', 0), ('monthly_income__isnull', True), _connector='OR'), name='client_monthly_income_positive'),
        ),
        migrations.AddConstraint(
            model_name='client',
            constraint=models.CheckConstraint(condition=models.Q(('number_of_dependents__gte', 0), ('number_of_dependents__isnull', True), _connector='OR'), name='client_dependents_positive'),
        ),
        migrations.AddConstraint(
            model_name='client',
            constraint=models.CheckConstraint(condition=models.Q(('years_in_business__gte', 0), ('years_in_business__isnull', True), _connector='OR'), name='client_years_in_business_positive'),
        ),
        migrations.AddConstraint(
            model_name='client',
            constraint=models.CheckConstraint(condition=models.Q(('credit_score__gte', 0), ('credit_score__lte', 1000)), name='client_credit_score_range'),
        ),
        migrations.AddConstraint(
            model_name='client',
            constraint=models.CheckConstraint(condition=models.Q(models.Q(('group__isnull', True), ('group_role', '')), models.Q(('group__isnull', True), ('group_role', 'member')), ('group__isnull', False), _connector='OR'), name='client_group_role_requires_group'),
        ),
        migrations.AddConstraint(
            model_name='client',
            constraint=models.UniqueConstraint(condition=models.Q(('deleted_at__isnull', True)), fields=('email',), name='unique_active_client_email'),
        ),
        migrations.AddConstraint(
            model_name='client',
            constraint=models.UniqueConstraint(condition=models.Q(('deleted_at__isnull', True)), fields=('client_id',), name='unique_active_client_id'),
        ),
        migrations.AddConstraint(
            model_name='client',
            constraint=models.UniqueConstraint(condition=models.Q(('deleted_at__isnull', True), ('external_id__gt', '')), fields=('external_id',), name='unique_active_client_external_id'),
        ),
    ]
